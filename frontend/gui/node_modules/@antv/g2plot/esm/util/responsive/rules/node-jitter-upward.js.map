{"version":3,"file":"node-jitter-upward.js","sourceRoot":"","sources":["../../../../src/util/responsive/rules/node-jitter-upward.ts"],"names":[],"mappings":"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","sourcesContent":["import { IShape } from '@antv/g-base';\nimport { each } from '@antv/util';\nimport { isNodeOverlap } from './clear-overlapping';\n\n/** 图形向上抖开并拉线 */\n// todo 允许设置offset和拉线样式\nexport default function nodeJitterUpward(shape: IShape, option, index, cfg) {\n  const nodes = cfg.nodes.nodes;\n  if (index === 0) {\n    return;\n  }\n  const current = nodes[index];\n  const previous = nodes[index - 1];\n  if (isNodeOverlap(current, previous)) {\n    const element = cfg.plot.plot.get('elements')[0];\n    const y = previous.top - current.height / 2;\n    const offset = 10;\n    if (y - offset > cfg.region.top) {\n      // 取到label对应的element-shape\n      const origin = current.shape.get('origin');\n      const shapeId = element.getShapeId(origin);\n      const shapes = element.getShapes();\n      const shapeBbox = getShapeById(shapeId, shapes).get('box');\n      const originX = shapeBbox.left + shapeBbox.width / 2;\n      const originY = shapeBbox.top;\n      // 拉线\n      const container = element.get('labelController').labelsContainer;\n      const labelLine = container.addShape('path', {\n        attrs: {\n          path: [\n            ['M', originX, originY],\n            ['L', current.shape.attr('x'), y],\n          ],\n          stroke: '#ccc',\n          lineWidth: 1,\n        },\n      });\n      /** 保存labelLine和label初始位置信息 */\n      const origin_position = { x: shape.attr('x'), y: shape.attr('y') };\n      // 更新标签位置，同步更新node\n      current.shape.attr('y', y - offset);\n      nodes[index] = cfg.nodes.measure(current.shape);\n      nodes[index].line = labelLine;\n      nodes[index].origin_position = origin_position;\n    }\n  }\n}\n\nfunction getShapeById(shapeId, shapes) {\n  let target;\n  each(shapes, (shape) => {\n    const s = shape as IShape;\n    const id = s.get('id');\n    if (id === shapeId) {\n      target = s;\n    }\n  });\n  return target;\n}\n"]}
{"version":3,"file":"globalLegend.js","sourceRoot":"","sources":["../../../src/combo-plots/util/globalLegend.ts"],"names":[],"mappings":"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","sourcesContent":["import { Legend } from '../../dependents';\nimport BBox from '../../util/bbox';\nimport * as _ from '@antv/util';\nimport ViewLayer from '../../base/view-layer';\nimport { getGlobalTheme } from '../../theme/global';\n\nexport function getLegendData(viewLayer: ViewLayer, props) {\n  const legendItems = [];\n  const view = viewLayer.view;\n  const geometry = view.geometries[0];\n  const colorAttr = geometry.attributes.color; // color和shape决定cat legend的生成，暂时先不考虑shape\n  const markerCfg: any = {\n    isInCircle: false,\n    color: colorAttr.values[0],\n  };\n\n  let marker = {\n    symbol: 'circle',\n    style: {\n      r: 4,\n      fill: markerCfg.fill,\n    },\n  };\n  // @ts-ignore\n  if (geometry.shapeFactory) {\n    // @ts-ignore\n    marker = geometry.shapeFactory.getMarker(geometry.type, markerCfg);\n  }\n  /** 处理default不生成图例的场景 */\n  if (colorAttr.scales.length === 1 && colorAttr.scales[0].type == 'identity') {\n    legendItems.push({\n      value: props.name,\n      checked: true,\n      marker,\n      isSingle: true,\n      layer: viewLayer,\n      name: props.name || geometry.type,\n    });\n  } else {\n    /** 正常生成图例 */\n    const values = colorAttr.scales[0].values;\n    _.each(values, (v, index) => {\n      const markerColor = colorAttr.values[index];\n      const markerValue = v;\n      const cfg: any = {\n        isInCircle: false,\n        color: markerColor,\n      };\n      let marker = {\n        symbol: 'circle',\n        style: {\n          r: 4,\n          fill: markerCfg.color,\n        },\n      };\n      // @ts-ignore\n      if (geometry.shapeFactory) {\n        // @ts-ignore\n        marker = geometry.shapeFactory.getMarker(geometry.type, cfg);\n      }\n      legendItems.push({\n        field: colorAttr.scales[0].field,\n        value: markerValue,\n        checked: true,\n        marker,\n        isSingle: false,\n        layer: viewLayer,\n        name: markerValue,\n      });\n    });\n  }\n\n  return legendItems;\n}\n\nexport function mergeLegendData(items) {\n  return items;\n}\n\nexport function createLegend(items, width, height, canvas, position) {\n  const legendTheme = getGlobalTheme().legend;\n  const positions = position.split('-');\n  let layout = 'horizontal';\n  if (positions[0] === 'left' || positions[0] === 'right') {\n    layout = 'vertical';\n  }\n  const container = canvas.addGroup();\n  const legendCfg = {\n    type: 'category-legend',\n    items,\n    maxSize: width,\n    container,\n    group: container,\n    layout: layout,\n    textStyle: {\n      fill: '#8C8C8C',\n      fontSize: 12,\n      textAlign: 'start',\n      textBaseline: 'middle',\n      lineHeight: 20,\n    }, // 图例项目文本样式\n    titleDistance: 10, // 标题和图例项的间距\n    autoWrap: true, // 图例项是否自动换行\n    itemMarginBottom: 4, // 图例项之间的底部间距\n    backgroundPadding: 0, // 背景内边距\n    maxLength: width, // 图例的最大高度或者宽度\n  };\n  const legend = new Legend.Category(legendCfg as any);\n  legendLayout(width, height, legend, position);\n  addLegendInteraction(legend);\n  /** return legend as a padding component */\n  const bbox = legend.get('container').getBBox();\n  let paddingBbox;\n  // merge legend inner padding\n  const { innerPadding } = legendTheme;\n\n  if (positions[0] === 'left') {\n    paddingBbox = new BBox(legend.get('x') + innerPadding[3], legend.get('y'), bbox.width, bbox.height);\n  } else if (positions[0] === 'right') {\n    paddingBbox = new BBox(legend.get('x') - innerPadding[1], legend.get('y'), bbox.width, bbox.height);\n  } else if (positions[0] === 'top') {\n    paddingBbox = new BBox(legend.get('x'), legend.get('y') + innerPadding[0], bbox.width, bbox.height);\n  } else if (positions[0] === 'bottom') {\n    paddingBbox = new BBox(legend.get('x'), legend.get('y') - innerPadding[2], bbox.width, bbox.height);\n  }\n  return {\n    position: positions[0],\n    component: legend,\n    getBBox: () => {\n      return paddingBbox;\n    },\n  };\n}\n\nfunction addLegendInteraction(legend) {\n  const filteredValue = [];\n  legend.get('group').on('click', (ev) => {\n    const item = ev.target.get('delegateObject').item;\n    // 如果是单图例模式\n    if (item.isSingle) {\n      if (item.checked) {\n        ev.target.get('parent').attr('opacity', 0.3);\n        item.layer.hide();\n        item.checked = false;\n      } else {\n        ev.target.get('parent').attr('opacity', 1);\n        item.layer.show();\n        item.checked = true;\n      }\n    } else {\n      // 正常的图例筛选数据逻辑\n      const view = item.layer.view;\n      if (item.checked) {\n        ev.target.get('parent').attr('opacity', 0.3);\n        filteredValue.push(item.value);\n        view.filter(item.field, (f) => {\n          return !_.contains(filteredValue, f);\n        });\n        view.render();\n        const filteredData = view.filteredData;\n        if (filteredData.length === 0) {\n          item.layer.hide();\n        } else if (!item.layer.visibility) {\n          item.layer.show();\n        }\n        item.checked = false;\n      } else {\n        ev.target.get('parent').attr('opacity', 1);\n        _.pull(filteredValue, item.value);\n        view.filter(item.value, (f) => {\n          return !_.contains(filteredValue, f);\n        });\n        view.render();\n        if (!item.layer.visibility) {\n          item.layer.show();\n        }\n        item.checked = true;\n      }\n    }\n  });\n}\n\nfunction legendLayout(width, height, legend, position) {\n  const { bleeding } = getGlobalTheme();\n  if (_.isArray(bleeding)) {\n    _.each(bleeding, (it, index) => {\n      if (typeof bleeding[index] === 'function') {\n        bleeding[index] = bleeding[index]({});\n      }\n    });\n  }\n  const bbox = legend.get('container').getBBox();\n  let x = 0;\n  let y = 0;\n  const positions = position.split('-');\n  // 先确定x\n  if (positions[0] === 'left') {\n    x = bleeding[3];\n  } else if (positions[0] === 'right') {\n    x = width - bleeding[1] - bbox.width;\n  } else if (positions[1] === 'center') {\n    x = (width - bbox.width) / 2;\n  } else if (positions[1] === 'left') {\n    x = bleeding[3];\n  } else if (positions[1] === 'right') {\n    x = width - bleeding[1] - bbox.width;\n  }\n  // 再确定y\n  if (positions[0] === 'bottom') {\n    y = height - bleeding[2] - bbox.height;\n  } else if (positions[0] === 'top') {\n    y = bleeding[0];\n  } else if (positions[1] === 'center') {\n    y = (height - bbox.height) / 2;\n  } else if (positions[1] === 'top') {\n    y = bleeding[0];\n  } else if (positions[1] === 'bottom') {\n    y = height - bleeding[2] - bbox.height;\n  }\n  //legend.moveTo(x, y);\n  legend.setLocation({ x, y });\n  legend.render();\n  //legend.draw();\n}\n"]}
{"version":3,"file":"shape.js","sourceRoot":"","sources":["../../../src/plots/calendar/shape.ts"],"names":[],"mappings":"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","sourcesContent":["import { isEmpty } from '@antv/util';\nimport { registerShape } from '@antv/g2';\nimport { DATE_FIELD } from './constant';\nimport { isLastDayOfMonth, isLastWeekOfMonth } from '../../util/date';\nimport { Point } from '../..';\n\n/**\n * 注册自定义日历图的 shape\n * code from https://g2.antv.vision/zh/examples/heatmap/heatmap#calendar-horizontal\n */\nregisterShape('polygon', 'calendar-polygon', {\n  draw(cfg, container) {\n    if (!isEmpty(cfg.points)) {\n      const points = cfg.points as Point[];\n      // rect path\n      let path = [\n        ['M', points[0].x, points[0].y],\n        ['L', points[1].x, points[1].y],\n        ['L', points[2].x, points[2].y],\n        ['L', points[3].x, points[3].y],\n        ['Z'],\n      ];\n      path = this.parsePath(path);\n\n      const attrs = {\n        stroke: '#fff',\n        lineWidth: 1,\n        fill: cfg.color,\n        ...cfg.style,\n        path,\n      };\n\n      const polygon = container.addShape('path', {\n        attrs,\n      });\n\n      const date: Date = cfg.data[DATE_FIELD];\n\n      if (isLastWeekOfMonth(date)) {\n        const linePath = [\n          ['M', points[2].x, points[2].y],\n          ['L', points[3].x, points[3].y],\n        ];\n        // 最后一周的多边形添加右侧边框\n        container.addShape('path', {\n          zIndex: 1,\n          attrs: {\n            path: this.parsePath(linePath),\n            lineWidth: 1,\n            stroke: '#404040',\n          },\n        });\n        if (isLastDayOfMonth(date)) {\n          container.addShape('path', {\n            zIndex: 1,\n            attrs: {\n              path: this.parsePath([\n                ['M', points[1].x, points[1].y],\n                ['L', points[2].x, points[2].y],\n              ]),\n              lineWidth: 1,\n              stroke: '#404040',\n            },\n          });\n        }\n      }\n\n      container.sort();\n\n      return polygon;\n    }\n  },\n});\n"]}